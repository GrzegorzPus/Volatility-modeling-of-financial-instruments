---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r include=FALSE}
install.packages("quantmod")
install.packages("xts")
install.packages("fGarch")
install.packages("PerformanceAnalytics")
#install.packages("Closexlsx")
install.packages("rugarch")
install.packages("readxl")
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```         
library(quantmod)
library(xts)
library(fGarch)
library(PerformanceAnalytics)
library(rugarch) 
library(readxl)
```

```{r}
library(quantmod)
library(xts)
library(fGarch)
library(PerformanceAnalytics)
library(rugarch) 
library(readxl)
```

```{r include=FALSE}
data <- read_excel("C:\\Users\\GRZEGORZ\\OneDrive\\Pulpit\\Studia\\Analiza finansowych szeregów czasowych\\Analiza zmiennosci-dane.xlsx", col_names=TRUE)
data_a <- read_excel("C:\\Users\\GRZEGORZ\\OneDrive\\Pulpit\\Studia\\Analiza finansowych szeregów czasowych\\Analiza zmiennosci-dane.xlsx", sheet = 2, col_names = TRUE)
data$Date <- as.Date(data$Date)
data_a$Date <- as.Date(data_a$Date)
```

```{r}
head(data_a)
```

```{r include=FALSE}
price <- data_a$Close
price <- as.matrix(price)
```

```{r}
returns <- 100*diff(log(price))
```

```{r include=FALSE}
returns <- as.matrix(returns)
return_date <- data[, 1:2]
```

## Plots

```{r}
chartSeries(data_a)
```

```{r}
chartSeries(subset(data_a, format(Date, "%Y-%m") == "2024-01"))
```

```{r}
plot(returns, type = "l")
```

```{r}
chart.Histogram(100*diff(log(data_a$Close)),
                methods = c('add.density', 'add.normal'),
                colorset = c('blue', 'red', 'green'))
legend("topright", legend = "Normal density", fill = "green", cex=0.5)
```

```{r}
acf(returns, plot = TRUE)
```

```{r}
acf(returns^2, plot = TRUE)
```

## Analysis

### AR(1)-GARCH(1,1) with conditional normal distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "norm", 
                            start.pars = list(), fixed.pars = list())

ar1.garch11.norm <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.garch11.norm)
```

### AR(1)-GARCH(1,1) with conditional t-Student distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "std", 
                            start.pars = list(), fixed.pars = list())

ar1.garch11.std <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.garch11.std)
```

### AR(1)-GJR-GARCH(1,1) with conditional normal distribution

```{r warning=FALSE, paged.print=FALSE}
specification <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "norm", 
                            start.pars = list(), fixed.pars = list())

ar1.gjrgarch11.norm <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.gjrgarch11.norm)
```

### AR(1)-GJR-GARCH(1,1) with conditional t-Student distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "std", 
                            start.pars = list(), fixed.pars = list())

ar1.gjrgarch11.std <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.gjrgarch11.std)
```

### AR(1)-EGARCH(1,1) with conditional normal distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "norm", 
                            start.pars = list(), fixed.pars = list())

ar1.egarch11.norm <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.egarch11.norm)
```

### AR(1)-EGARCH(1,1) with conditional t-Student distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "std", 
                            start.pars = list(), fixed.pars = list())

ar1.egarch11.std <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.egarch11.std)
```

### AR(1)-GARCH(1, 1)-in-Mean with conditional normal distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = TRUE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "norm", 
                            start.pars = list(), fixed.pars = list())

ar1.garchm11.norm <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.garchm11.norm)
```

### AR(1)-GARCH(1, 1)-in-Mean with conditional t-Student distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = TRUE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "std", 
                            start.pars = list(), fixed.pars = list())

ar1.garchm11.std <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.garchm11.std)
```

### AR(1)-GJR-GARCH(1,1)-in-Mean with conditional normal distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = TRUE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "norm", 
                            start.pars = list(), fixed.pars = list())

ar1.gjrgarchm11.norm <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.gjrgarchm11.norm)
```

### AR(1)-GJR-GARCH(1,1)-in-Mean with conditional t-Student distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = TRUE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "std", 
                            start.pars = list(), fixed.pars = list())

ar1.gjrgarchm11.std <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.gjrgarchm11.std)
```

### AR(1)-EGARCH(1,1)-in-Mean with conditional normal distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = TRUE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "norm", 
                            start.pars = list(), fixed.pars = list())

ar1.egarchm11.norm <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.egarchm11.norm)
```

### AR(1)-EGARCH(1,1)-in-Mean with conditional t-Student distribution

```{r}
specification <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1,1), 
                                                  submodel = NULL, 
                                                  external.regressors = NULL,
                                                  variance.targeting = FALSE),
                            mean.model = list(armaOrder = c(1, 0), include.mean = TRUE,
                                              archm = TRUE, archpow = 1, arfima = FALSE, external.regressors = cbind(data$Brexit, data$Covid, data$Ukraine),
                                              archex = FALSE), 
                            distribution.model = "std", 
                            start.pars = list(), fixed.pars = list())

ar1.egarchm11.std <- ugarchfit(data = returns, spec = specification, solver = 'hybrid')

show(ar1.egarchm11.std)
```

## Information criteria

```{r include=FALSE}
information.criteria <- t(cbind(
  infocriteria(ar1.garch11.norm),
  infocriteria(ar1.garch11.std),
  infocriteria(ar1.gjrgarch11.norm),  
  infocriteria(ar1.gjrgarch11.std),
  infocriteria(ar1.egarch11.norm),
  infocriteria(ar1.egarch11.std),
  infocriteria(ar1.garchm11.norm),
  infocriteria(ar1.garchm11.std),
  infocriteria(ar1.gjrgarchm11.norm),
  infocriteria(ar1.gjrgarchm11.std),
  infocriteria(ar1.egarchm11.norm),
  infocriteria(ar1.egarchm11.std)
))
rownames(information.criteria) <- c("GARCH(1,1)-n", "GARCH(1,1)-t", "GJR-GARCH(1,1)-n", "GJR-GARCH(1,1)-t", "EGARCH(1,1)-n", "EGARCH(1,1)-t", "GARCH-M(1,1)-n", "GARCH-M(1,1)-t", "GJR-GARCH-M(1,1)-n", "GJR-GARCH-M(1,1)-t", "EGARCH-M(1,1)-n", "EGARCH-M(1,1)-t")
```

```{r}
information.criteria
```

```{r}
#par(mar = c(5, 5, 2, 2))
plot(ar1.egarch11.std, which = 'all')
```
